{"version":3,"file":"routes.js","sources":["routes.js","delivery/editDelivery.js","delivery/testtaker.js","runtime/deliveryExecution.js"],"names":["define","Delivery","actions","editDelivery","excludeTesttaker","$","helpers","start","click","delivery","this","data","load","_url","uri","prepend","modal","__","module","section","feedback","switchList","target","current","parent","attr","append","scrollIntoView","timeout","$search","$list","liveSearch","pattern","val","clearTimeout","setTimeout","filterList","RegExp","regex","list","children","each","index","element","text","match","hide","show","excluded","push","assemblyUri","ajax","url","type","JSON","stringify","dataType","success","response","saved","loadContentBlock","keyup","siblings","iframeResizer","context","loadingBar","resizeMainFrame","height","window","outerHeight","$headerHeight","$footerHeight","$frameContainer","$frame","options","find","document","on","location","root_url","serviceApi","onFinish","finishDeliveryExecution","deliveryExecution","destination","stop","off","loadInto","get","bind"],"mappings":"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","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n * \n * \n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('taoDelivery/controller/routes',[],function(){\n    'use strict';\n\n    return {\n        'Delivery': {\n            'actions' : {\n            \t'editDelivery'     : 'controller/delivery/editDelivery',\n\t            'excludeTesttaker' : 'controller/delivery/testtaker'\n            }\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoDelivery/controller/delivery/editDelivery',['jquery', 'helpers', 'ui/modal'],\nfunction ($, helpers) {\n\t'use strict';\n\t\n\treturn {\n        start : function(){\n            $('#exclude-btn').click(function() {\n            \tvar delivery = $(this).data('delivery');\n        \t    $('#testtaker-form').load(helpers._url('excludeTesttaker', 'Delivery', 'taoDelivery', {'uri' : delivery}), function() {\n                    $('body').prepend($('#modal-container'));\n                    $('#testtaker-form').modal();\n                });\n        \t});\n        }\n\t}\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoDelivery/controller/delivery/testtaker',['jquery', 'i18n', 'helpers', 'module', 'layout/section', 'ui/feedback'], \nfunction ($, __, helpers, module, section, feedback) {\n    'use strict';\n\n\tfunction switchList() {\n\t\tvar current = $(this).parent().attr('id');\n        var target; \n\t\tif (current == 'excludedList') {\n\t\t\ttarget = $('#assignedList'); \n\t\t} else if (current == 'assignedList') {\n\t\t\ttarget = $('#excludedList');\n\t\t}\n\t\tif (typeof target !== 'undefined') {\n\t\t\ttarget.append(this);\n\t\t\tthis.scrollIntoView();\n\t\t}\n\t}\n\t\n\tvar $search = $('#tt-filter');\n    var $list   = $('#assignedList');\n    var timeout;\n    \n    var liveSearch = function(){\n        var pattern = $search.val();\n        clearTimeout(timeout);\n        timeout = setTimeout(function(){\n        \tfilterList(new RegExp(pattern), $list);\n        }, 300);\n    };\n    \n    var filterList = function(regex, list) {\n    \tlist.children().each(function(index, element) {\n    \t\tif ($(element).text().match(regex) === null) {\n    \t\t\t$(element).hide();\n    \t\t} else {\n    \t\t\t$(element).show();\n    \t\t}\n    \t});\n    };\n\t\n    return {\n        start : function(){\n\t        $('#save-tt').click(function() {\n\t        \tvar excluded = [];\n\t        \t$('#excludedList > li').each(function(index) {\n\t        \t\texcluded.push($(this).data('uri'));\n\t        \t});\n\t        \tvar assemblyUri = $('input[name=\"assemblyUri\"]').val();\n\t        \t$.ajax({\n\t        \t\turl: helpers._url('saveExcluded', 'Delivery', 'taoDelivery'),\n\t\t\t\t\ttype: \"POST\",\n\t\t\t\t\tdata: {\n\t\t\t\t\t\turi: assemblyUri,\n\t\t\t\t\t\texcluded: JSON.stringify(excluded)\n\t\t\t\t\t},\n\t\t\t\t\tdataType: 'json',\n\t\t\t\t\tsuccess: function(response) {\n\t\t\t\t\t\tif (response.saved) {\n                            feedback().success(__('Selection saved successfully'));\n                            section.loadContentBlock(helpers._url('editDelivery', 'Delivery', 'taoDelivery'), {uri: assemblyUri});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t        });\n        \t$('#assignedList > li').click(switchList);\n        \t$('#excludedList > li').click(switchList);\n        \t\n        \t$('#close-tt').click(function() {\n        \t\t$('#testtaker-form').modal('close');\n        \t});\n                \n            //trigger the search on keyp and on the magnifer button click\n            $search.keyup(liveSearch).siblings('.ctrl').click(liveSearch);\n        \t\n        }\n    };\n});\n\n\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoDelivery/controller/runtime/deliveryExecution',[\n    'jquery',\n    'iframeResizer',\n    'context',\n    'layout/loading-bar'\n], function($, iframeResizer, context, loadingBar){\n    \n    'use strict';\n    \n    var $frameContainer,\n        $frame,\n        $headerHeight,\n        $footerHeight;\n\n    function resizeMainFrame() {\n        var height = $(window).outerHeight() - $headerHeight - $footerHeight;\n        $frameContainer.height(height);\n        $frame.height(height);\n    }\n    \n    return {\n        start: function(options){\n\n            $frameContainer = $('#outer-delivery-iframe-container');\n            $frame = $frameContainer.find('iframe');\n            $headerHeight = $('body > .content-wrap > header').outerHeight();\n            $footerHeight = $('body > footer').outerHeight();\n\n            $(document).on('serviceforbidden', function() {\n                window.location = context.root_url + 'tao/Main/logout';\n            });\n\n            var serviceApi = options.serviceApi;\n\n            serviceApi.onFinish(function() {\n                $.ajax({\n                    url : options.finishDeliveryExecution,\n                    data : {\n                        'deliveryExecution' : options.deliveryExecution\n                    },\n                    type : 'post',\n                    dataType : 'json',\n                    success : function(data) {\n                        window.location = data.destination;\n                    }\n                });\n            });\n            \n            $(document)\n                .on('loading', function(e){\n                    loadingBar.start();\n                })\n                .on('unloading', function(){\n                    setTimeout(function(){\n                        loadingBar.stop();\n                    }, 300);\n                })\n                .on('shutdown-com', function(){\n                    //use when we want to stop all exchange between frames\n                    $(document).off('heightchange');\n                    $frame.off('load.eventHeight')\n                           .off('load.cors');\n                });\n            \n            serviceApi.loadInto($frame.get(0));\n            \n            $(window).bind('resize', function() {\n                resizeMainFrame();\n            });\n            \n            resizeMainFrame();\n        }\n    };\n});\n"]}